<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAST LETTER • Ends With Mode</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto+Mono:wght@400;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      height:100vh;background:#000;color:#0f0;font-family:'Courier New',monospace;
      overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;
      user-select:none;
    }
    #startScreen,#game{display:none;text-align:center;}
    #startScreen{display:block;}
    h1{font-family:'Orbitron',sans-serif;font-size:70px;color:#0f0;text-shadow:0 0 30px #0f0;margin-bottom:40px;}
    button{padding:20px 60px;font-size:40px;background:#0f0;color:#000;border:none;border-radius:20px;cursor:pointer;box-shadow:0 0 40px #0f0;}
    button:hover{transform:scale(1.1);}
    #required{font-size:180px;margin:40px 0;text-shadow:0 0 40px #0f0;}
    #typed{font-size:120px;color:#0ff;text-shadow:0 0 30px #0ff;min-height:140px;}
    #timer{font-size:60px;color:#f33;margin:20px;}
    .pulse{animation:pulse 0.6s infinite;}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
    #msg{position:fixed;bottom:80px;font-size:40px;color:#f66;opacity:0;transition:opacity .5s;}
    #msg.show{opacity:1;}
    #info{position:absolute;top:20px;left:20px;font-size:20px;color:#aaa;}
  </style>
</head>
<body>

  <div id="startScreen">
    <h1>LAST LETTER</h1>
    <p style="font-size:24px;margin:20px;color:#0f0;">Type any word that <strong>ENDS</strong> with the letter!</p>
    <button onclick="startGame()">PLAY</button>
  </div>

  <div id="game">
    <div id="info">
      Hearts Hearts Hearts | STREAK <span id="streak">0</span> | Best: <span id="best">0</span>
    </div>
    <div id="required">?</div>
    <div id="typed"></div>
    <div id="timer">10</div>
    <div id="msg"></div>
  </div>

  <script>
    const requiredEl = document.getElementById('required');
    const typedEl = document.getElementById('typed');
    const timerEl = document.getElementById('timer');
    const streakEl = document.getElementById('streak');
    const bestEl = document.getElementById('best');
    const msgEl = document.getElementById('msg');

    let words = new Set();
    let used = new Set();
    let requiredLetter = '', typed = '';
    let lives = 3, streak = 0, best = parseInt(localStorage.getItem('lastLetterBest')||'0');
    bestEl.textContent = best;
    let timer = 10, timerId = null, gameActive = false;

    // Load your 400k word list from word.txt
    fetch('word.txt')
      .then(r => r.text())
      .then(text => {
        text.split('\n')
          .map(w => w.trim().toLowerCase())
          .filter(w => w.length >= 1 && /^[a-z]+$/.test(w))
          .forEach(w => words.add(w));
        console.log('Loaded', words.size, 'words from word.txt');
      })
      .catch(() => alert('word.txt not found!'));

    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('game').style.display = 'block';
      resetGame();
      nextTurn();
    }

    function resetGame() {
      used.clear(); streak = 0; lives = 3;
      updateHearts(); updateStreak();
    }

    function nextTurn() {
      typed = ''; typedEl.textContent = '';

      // First turn = any word → next turn uses its last letter
      if (streak === 0) {
        requiredEl.textContent = 'ANY';
        requiredLetter = '';
      } else {
        requiredLetter = getRandomLetter();
        requiredEl.textContent = requiredLetter.toUpperCase();
      }

      timer = 10; timerEl.textContent = timer;
      timerEl.classList.remove('pulse');
      clearInterval(timerId);
      timerId = setInterval(() => {
        timer--;
        timerEl.textContent = timer;
        if (timer <= 3) timerEl.classList.add('pulse');
        if (timer <= 0) fail();
      }, 1000);
      gameActive = true;
    }

    function getRandomLetter() {
      return String.fromCharCode(97 + Math.floor(Math.random()*26));
    }

    function submit() {
      if (!gameActive) return;
      const word = typed.toLowerCase();

      if (word.length < 1) return msg("Too short!");
      if (requiredLetter && word[word.length-1] !== requiredLetter) {
        return msg("Must end with " + requiredLetter.toUpperCase() + "!");
      }
      if (!words.has(word)) return msg("Not in list!");
      if (used.has(word)) return msg("Already used!");

      clearInterval(timerId);
      used.add(word);
      streak++;

      // Next required letter = last letter of this word
      requiredLetter = word[word.length-1];

      if (streak > best) {
        best = streak;
        localStorage.setItem('lastLetterBest', best);
        bestEl.textContent = best;
      }
      updateStreak();
      setTimeout(nextTurn, 600);
    }

    function fail() {
      clearInterval(timerId);
      lives--;
      updateHearts();
      msg(lives > 0 ? "Time out!" : "GAME OVER");
      if (lives === 0) {
        gameActive = false;
        setTimeout(() => {
          alert(`GAME OVER!\nStreak: ${streak}\nBest: ${best}`);
          location.reload();
        }, 1000);
      } else {
        setTimeout(nextTurn, 1200);
      }
    }

    function msg(text) {
      msgEl.textContent = text;
      msgEl.classList.add('show');
      setTimeout(() => msgEl.classList.remove('show'), 1000);
    }

    function updateHearts() {
      document.querySelector('#info').innerHTML = 
        'Hearts'.repeat(lives) + 'Broken Heart'.repeat(3-lives) + 
        ` | STREAK <span id="streak">${streak}</span> | Best: ${best}`;
    }
    function updateStreak() { streakEl.textContent = streak; }

    document.addEventListener('keydown', e => {
      if (!gameActive) return;
      if (/^[a-zA-Z]$/.test(e.key)) {
        typed += e.key.toLowerCase();
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Backspace') {
        typed = typed.slice(0,-1);
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Enter') {
        submit();
      }
    });
  </script>
</body>
</html>
