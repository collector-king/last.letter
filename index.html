<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Last Letter - Dark Mode</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      user-select: none;
    }
    #startScreen, #game {
      text-align: center;
    }
    #startBtn {
      padding: 20px 60px;
      font-size: 40px;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 0 30px #0f0;
      transition: 0.3s;
    }
    #startBtn:hover { transform: scale(1.1); box-shadow: 0 0 50px #0f0; }

    #game {
      display: none;
      width: 100%;
    }
    #streak {
      font-size: 36px;
      color: #ff0;
      text-shadow: 0 0 15px gold;
      margin-bottom: 20px;
    }
    #main {
      font-size: 160px;
      font-weight: bold;
      line-height: 1.2;
      text-shadow: 0 0 40px #0f0;
      letter-spacing: 8px;
    }
    #requiredLetter {
      display: inline-block;
      min-width: 160px;
    }
    #typedWord {
      display: inline-block;
      color: #0ff;
      text-shadow: 0 0 30px cyan;
    }
    #timer {
      font-size: 50px;
      color: #f33;
      margin: 30px 0;
    }
    #hud {
      position: absolute;
      top: 30px;
      left: 30px;
      font-size: 32px;
      color: #fff;
    }
    #msg {
      position: absolute;
      bottom: 60px;
      font-size: 36px;
      color: #f33;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .pulse { animation: pulse 0.8s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
  </style>
</head>
<body>

  <div id="startScreen">
    <h1 style="font-size:70px; margin:0; color:#0f0; text-shadow:0 0 30px #0f0;">LAST LETTER</h1>
    <button id="startBtn" onclick="startGame()">START</button>
  </div>

  <div id="game">
    <div id="hud">Hearts Hearts Hearts</div>
    <div id="streak">STREAK: <strong>0</strong></div>
    <div id="main">
      <span id="requiredLetter">?</span><span id="typedWord"></span>
    </div>
    <div id="timer">10</div>
    <div id="msg"></div>
  </div>

  <script>
    const startScreen = document.getElementById('startScreen');
    const game = document.getElementById('game');
    const requiredEl = document.getElementById('requiredLetter');
    const typedEl = document.getElementById('typedWord');
    const timerEl = document.getElementById('timer');
    const streakEl = document.getElementById('streak').querySelector('strong');
    const heartsEl = document.getElementById('hud');
    const msgEl = document.getElementById('msg');

    let words = [], wordMap = new Map(), used = new Set();
    let chain = [], currentLetter = '', typed = '';
    let lives = 3, tries = 3, streak = 0, best = 0;
    let timer = 10, timerId = null, gameActive = false;

    // Load dictionary
    fetch('https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt')
      .then(r => r.text())
      .then(t => {
        words = t.split('\n').map(w => w.trim().toLowerCase()).filter(w => w.length >= 3);
        for (let w of words) {
          let first = w[0];
          if (!wordMap.has(first)) wordMap.set(first, new Set());
          wordMap.get(first).add(w);
        }
      });

    function startGame() {
      startScreen.style.display = 'none';
      game.style.display = 'block';
      best = parseInt(localStorage.getItem('lastLetterBest') || '0');
      resetGame();
      nextTurn();
    }

    function resetGame() {
      used.clear(); chain = []; typed = ''; lives = 3; tries = 3; streak = 0;
      updateHearts(); updateStreak();
    }

    function nextTurn() {
      typed = '';
      typedEl.textContent = '';
      tries = 3;

      if (chain.length === 0) {
        requiredEl.textContent = 'ANY';
        currentLetter = '';
      } else {
        currentLetter = chain[chain.length-1].slice(-1);
        requiredEl.textContent = currentLetter.toUpperCase();
      }

      timer = 10;
      timerEl.textContent = timer;
      timerEl.classList.remove('pulse');
      clearInterval(timerId);
      timerId = setInterval(() => {
        timer--;
        timerEl.textContent = timer;
        if (timer <= 3) timerEl.classList.add('pulse');
        if (timer <= 0) failTurn();
      }, 1000);

      gameActive = true;
    }

    function submitWord() {
      if (!gameActive) return;
      const word = typed.toLowerCase();
      if (word.length < 3) return error("Too short!");
      if (currentLetter && word[0] !== currentLetter) return error("Wrong letter!");
      if (!words.includes(word)) return error("Not a word!");
      if (used.has(word)) return error("Already used!");

      clearInterval(timerId);
      used.add(word);
      chain.push(word);
      streak = chain.length;
      if (streak > best) {
        best = streak;
        localStorage.setItem('lastLetterBest', best);
      }
      updateStreak();
      typedEl.style.color = '#0f0';
      setTimeout(nextTurn, 700);
    }

    function failTurn() {
      clearInterval(timerId);
      lives--;
      updateHearts();
      error(lives > 0 ? "Time out!" : "GAME OVER");
      if (lives === 0) {
        gameActive = false;
        setTimeout(() => {
          msgEl.innerHTML = `GAME OVER<br>STREAK ${streak} | BEST ${best}<br><button onclick="location.reload()" style="margin-top:20px;padding:15px 40px;font-size:28px;background:#0f0;color:#000;border:none;border-radius:12px;cursor:pointer;">PLAY AGAIN</button>`;
          msgEl.style.opacity = 1;
        }, 800);
      } else {
        setTimeout(nextTurn, 1200);
      }
    }

    function error(text) {
      tries--;
      if (tries <= 0) { failTurn(); return; }
      msgEl.textContent = text;
      msgEl.style.opacity = 1;
      setTimeout(() => msgEl.style.opacity = 0, 900);
    }

    function updateHearts() {
      heartsEl.textContent = 'Hearts'.repeat(lives) + 'Broken Heart'.repeat(3-lives);
    }
    function updateStreak() {
      streakEl.textContent = streak;
    }

    // Keyboard typing
    document.addEventListener('keydown', e => {
      if (!gameActive) return;
      if (/^[a-zA-Z]$/.test(e.key)) {
        typed += e.key.toLowerCase();
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Backspace') {
        typed = typed.slice(0, -1);
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Enter') {
        submitWord();
      }
    });

    // Init
    updateHearts();
  </script>
</body>
</html>
