<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Last Letter - Dark Keyboard Mode</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      user-select: none;
    }
    #startScreen {
      text-align: center;
    }
    #startBtn {
      padding: 20px 50px;
      font-size: 32px;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 0 20px #0f0;
      transition: all 0.3s;
    }
    #startBtn:hover { transform: scale(1.1); box-shadow: 0 0 40px #0f0; }

    #game {
      display: none;
      text-align: center;
      width: 100%;
    }
    #currentLetter {
      font-size: 180px;
      font-weight: bold;
      margin: 0;
      height: 200px;
      line-height: 200px;
      text-shadow: 0 0 30px #0f0;
      letter-spacing: 10px;
    }
    #timer {
      font-size: 48px;
      color: #f33;
      margin: 20px 0;
    }
    #typed {
      font-size: 60px;
      min-height: 80px;
      color: #0f0;
      text-shadow: 0 0 20px #0f0;
    }
    #hud {
      position: absolute;
      top: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 40px;
      font-size: 28px;
      color: #fff;
    }
    #hearts { color: #f33; }
    #streak { color: #ff0; text-shadow: 0 0 10px gold; }
    #msg {
      position: absolute;
      bottom: 50px;
      font-size: 32px;
      color: #f33;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .pulse { animation: pulse 1s infinite; }
    @keyframes pulse { 0%,100% { opacity: 1 } 50% { opacity: 0.5 } }
  </style>
</head>
<body>

  <div id="startScreen">
    <h1 style="font-size:60px; margin-bottom:50px; color:#0f0; text-shadow:0 0 20px #0f0;">
      LAST LETTER
    </h1>
    <button id="startBtn" onclick="startGame()">START GAME</button>
  </div>

  <div id="game">
    <div id="hud">
      <div id="hearts">Hearts Hearts Hearts</div>
      <div id="streak">Streak: <strong>0</strong></div>
    </div>

    <div id="currentLetter">?</div>
    <div id="timer">10</div>
    <div id="typed"></div>
    <div id="msg"></div>
  </div>

  <script>
    const startScreen = document.getElementById('startScreen');
    const game = document.getElementById('game');
    const currentLetterEl = document.getElementById('currentLetter');
    const typedEl = document.getElementById('typed');
    const timerEl = document.getElementById('timer');
    const msgEl = document.getElementById('msg');

    let words = [], wordMap = new Map(), used = new Set();
    let chain = [], currentLetter = '', typed = '';
    let lives = 3, tries = 3, streak = 0, best = 0;
    let timer = 10, timerId = null, gameActive = false;

    // Load dictionary
    fetch('https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt')
      .then(r => r.text())
      .then(text => {
        words = text.split('\n').map(w=>w.trim().toLowerCase()).filter(w=>w.length>=3);
        for (let w of words) {
          let first = w[0];
          if (!wordMap.has(first)) wordMap.set(first, new Set());
          wordMap.get(first).add(w);
        }
      });

    function startGame() {
      startScreen.style.display = 'none';
      game.style.display = 'block';
      resetGame();
      nextTurn();
    }

    function resetGame() {
      used.clear(); chain = []; typed = ''; lives = 3; tries = 3; streak = 0;
      updateHearts(); updateStreak();
    }

    function nextTurn() {
      if (chain.length === 0) {
        currentLetter = '';
        currentLetterEl.textContent = 'ANY';
      } else {
        currentLetter = chain[chain.length-1].slice(-1);
        currentLetterEl.textContent = currentLetter.toUpperCase();
      }
      typed = '';
      typedEl.textContent = '';
      tries = 3;
      timer = 10;
      timerEl.textContent = timer;
      clearInterval(timerId);
      timerId = setInterval(() => {
        timer--;
        timerEl.textContent = timer;
        if (timer <= 3) timerEl.classList.add('pulse');
        if (timer <= 0) failTurn();
      }, 1000);
      gameActive = true;
    }

    function submitWord() {
      if (!gameActive) return;
      let word = typed.toLowerCase();
      if (word.length < 3) return showMsg("Too short!");
      if (currentLetter && word[0] !== currentLetter) return showMsg("Wrong start!");
      if (!words.includes(word)) return showMsg("Not a word!");
      if (used.has(word)) return showMsg("Already used!");

      clearInterval(timerId);
      used.add(word);
      chain.push(word);
      streak = chain.length;
      if (streak > best) { best = streak; localStorage.setItem('lastLetterBest', best); }
      updateStreak();
      typedEl.textContent = word.toUpperCase();
      setTimeout(() => nextTurn(), 800);
    }

    function failTurn() {
      clearInterval(timerId);
      lives--;
      updateHearts();
      showMsg(lives > 0 ? "Time's up!" : "GAME OVER");
      if (lives === 0) {
        gameActive = false;
        setTimeout(() => {
          msgEl.innerHTML = `GAME OVER<br>Streak: ${streak} | Best: ${best}<br><button onclick="location.reload()" style="margin-top:20px;padding:15px 30px;font-size:24px;background:#0f0;color:#000;border:none;border-radius:10px;">Play Again</button>`;
        }, 1000);
      } else {
        setTimeout(() => nextTurn(), 1200);
      }
    }

    function showMsg(text) {
      msgEl.textContent = text;
      msgEl.style.opacity = 1;
      setTimeout(() => msgEl.style.opacity = 0, 1000);
    }

    function updateHearts() {
      document.getElementById('hearts').innerHTML = 'Hearts'.repeat(lives) + 'Broken Heart'.repeat(3-lives);
    }
    function updateStreak() {
      document.getElementById('streak').innerHTML = `Streak: <strong>${streak}</strong>`;
    }

    // Keyboard input
    document.addEventListener('keydown', e => {
      if (!gameActive) return;
      if (/^[a-zA-Z]$/.test(e.key)) {
        typed += e.key.toLowerCase();
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Backspace') {
        typed = typed.slice(0, -1);
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Enter') {
        submitWord();
      }
    });

    // Load best score
    best = parseInt(localStorage.getItem('lastLetterBest') || '0');
  </script>
</body>
</html>
