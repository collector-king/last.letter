<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAST LETTER â€¢ Roblox Style</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&display=swap');

    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      height:100vh;background:#000;color:#0f0;font-family:'JetBrains Mono',monospace;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      user-select:none;overflow:hidden;
    }
    h1{font-family:'JetBrains Mono',sans-serif;font-size:80px;color:#0f0;text-shadow:0 0 40px #0f0;margin:30px;}
    button{padding:20px 80px;font-size:40px;background:#0f0;color:#000;border:none;border-radius:20px;cursor:pointer;box-shadow:0 0 50px #0f0;}
    button:hover{transform:scale(1.1);}
    #game{display:none;flex-direction:column;align-items:center;}
    
    /* Word line with dark box + moving BLACK & GRAY gradient */
    #word-line{
      display:flex;align-items:center;justify-content:center;
      margin:80px 0 40px 0;
      padding:50px 100px;
      background:#000;
      border-radius:50px;
      box-shadow:0 0 100px rgba(255,255,255,0.15), inset 0 0 100px rgba(0,0,0,0.8);
      position:relative;
      overflow:hidden;
      border:2px solid #333;
    }
    
    /* Moving black & gray gradient */
    #word-line::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(90deg, 
        #000 0%, 
        #222 15%, 
        #444 30%, 
        #666 50%, 
        #444 70%, 
        #222 85%, 
        #000 100%
      );
      background-size:300% 300%;
      animation:gradientFlow 15s ease infinite;
      opacity:0.8;
      z-index:1;
    }
    
    #letter{
      font-size:240px;color:#fff;text-shadow:0 0 80px #aaa;
      position:relative;z-index:2;
      font-weight:800;
    }
    #typed{
      font-size:200px;color:#ccc;text-shadow:0 0 60px #888;margin-left:40px;
      position:relative;z-index:2;
      font-weight:700;
      min-width:100px;
    }
    
    #timer{font-size:70px;color:#f33;margin:20px;}
    #hud{position:absolute;top:20px;left:20px;font-size:24px;color:#fff;}
    #msg{position:fixed;bottom:100px;font-size:40px;color:#f66;background:rgba(0,0,0,0.7);padding:15px 40px;border-radius:20px;opacity:0;transition:all .4s;}
    #msg.show{opacity:1;bottom:120px;}
    .pulse{animation:pulse 0.6s infinite;}
    
    /* Leaderboard */
    #leaderboard{
      margin-top:50px;
      background:#111;
      padding:30px 60px;
      border-radius:30px;
      border:2px solid #333;
      min-width:400px;
      box-shadow:0 0 60px rgba(255,255,255,0.1);
    }
    #leaderboard h2{
      font-size:36px;
      text-align:center;
      margin-bottom:20px;
      color:#0ff;
      text-shadow:0 0 20px #0ff;
    }
    #leaderboard ol{
      list-style:none;
      counter-reset:lb;
      font-size:28px;
    }
    #leaderboard li{
      counter-increment:lb;
      margin:12px 0;
      color:#ccc;
    }
    #leaderboard li::before{
      content:counter(lb) ". ";
      color:#0f0;
      font-weight:bold;
      margin-right:15px;
    }
    #leaderboard .no-scores{
      color:#666;
      font-style:italic;
      text-align:center;
      margin-top:20px;
    }

    @keyframes gradientFlow{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
  </style>
</head>
<body>

  <div id="start">
    <h1>LAST LETTER</h1>
    <p style="font-size:28px;margin:20px;color:#0f0;">You DON'T type the first letter â€” just the rest!</p>
    <button onclick="startGame()">PLAY</button>

    <div id="leaderboard">
      <h2>LEADERBOARD (11+ streak)</h2>
      <ol id="lb-list">
        <div class="no-scores">No high scores yet!</div>
      </ol>
    </div>
  </div>

  <div id="game">
    <div id="hud">
      Hearts Hearts Hearts | STREAK <span id="streak">0</span> | Best: <span id="best">0</span>
    </div>
    
    <div id="word-line">
      <div id="letter"></div>
      <div id="typed"></div>
    </div>
    
    <div id="timer">10</div>
    <div id="msg"></div>
  </div>

  <script>
    const letterEl = document.getElementById('letter');
    const typedEl = document.getElementById('typed');
    const timerEl = document.getElementById('timer');
    const streakEl = document.getElementById('streak');
    const bestEl = document.getElementById('best');
    const msgEl = document.getElementById('msg');
    const lbList = document.getElementById('lb-list');

    let words = new Set();
    let used = new Set();
    let currentLetter = '';
    let typed = '';
    let lives = 3, streak = 0, best = parseInt(localStorage.getItem('lastLetterBest')||'0');
    bestEl.textContent = best;
    let timer = 10, timerId = null, playing = false;
    let lastWord = '';

    // Leaderboard: array of {name: "Player", score: 42}
    let leaderboard = JSON.parse(localStorage.getItem('lastLetterLB') || '[]');

    function updateLeaderboard() {
      lbList.innerHTML = '';
      if (leaderboard.length === 0) {
        lbList.innerHTML = '<div class="no-scores">No high scores yet! (11+ streak required)</div>';
        return;
      }
      leaderboard.forEach((entry, i) => {
        const li = document.createElement('li');
        li.textContent = `${entry.name} â€” ${entry.score}${i === 0 ? ' ðŸ‘‘' : ''}`;
        lbList.appendChild(li);
      });
    }

    function addToLeaderboard(name, score) {
      // Prevent duplicate exact entries
      const exists = leaderboard.some(e => e.name.toLowerCase() === name.toLowerCase() && e.score === score);
      if (exists) return;

      leaderboard.push({name, score});
      leaderboard.sort((a,b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem('lastLetterLB', JSON.stringify(leaderboard));
      updateLeaderboard();
    }

    updateLeaderboard();

    // Load word.txt
    fetch('word.txt?t=' + Date.now())
      .then(r => r.text())
      .then(text => {
        text.split('\n').forEach(line => {
          const w = line.trim().toLowerCase();
          if (w.length >= 2 && /^[a-z]+$/.test(w)) words.add(w);
        });
        console.log('Loaded', words.size, 'words');
      });

    function startGame() {
      document.getElementById('start').style.display = 'none';
      document.getElementById('game').style.display = 'flex';
      reset();
      newRound();
    }

    function reset() {
      lives = 3; streak = 0; used.clear();
      updateHUD();
    }

    function newRound() {
      typed = ''; typedEl.textContent = '';
      
      if (streak === 0) {
        letterEl.textContent = 'ANY â†’';
        currentLetter = '';
      } else {
        currentLetter = lastWord.slice(-1);
        letterEl.textContent = currentLetter.toUpperCase();
      }

      timer = 10; timerEl.textContent = '10';
      timerEl.classList.remove('pulse');
      clearInterval(timerId);
      timerId = setInterval(() => {
        timer--;
        timerEl.textContent = timer;
        if (timer <= 3) timerEl.classList.add('pulse');
        if (timer <= 0) die();
      }, 1000);
      playing = true;
    }

    function submit() {
      if (!playing) return;

      const rest = typed.toLowerCase();
      if (rest.length === 0) return msg("Type something!");

      const fullWord = currentLetter ? currentLetter + rest : rest;
      
      if (!words.has(fullWord)) return msg("Not a word!");
      if (used.has(fullWord)) return msg("Already used!");

      clearInterval(timerId);
      used.add(fullWord);
      lastWord = fullWord;
      streak++;
      if (streak > best) {
        best = streak;
        localStorage.setItem('lastLetterBest', best);
        bestEl.textContent = best;
      }
      updateHUD();
      setTimeout(newRound, 600);
    }

    function die() {
      clearInterval(timerId);
      lives--;
      updateHUD();
      if (lives === 0) {
        playing = false;

        // === ONLY IF STREAK > 10 â†’ FORCE USERNAME ===
        if (streak > 10) {
          let name = '';
          while (!name || name.trim() === '' || name.length > 20) {
            name = prompt(`HIGH SCORE ${streak}!\nEnter your username (1-20 chars):`) || '';
          }
          name = name.trim().substring(0,20);
          addToLeaderboard(name, streak);
        }

        msg("GAME OVER");
        setTimeout(() => location.reload(), 2000);
      } else {
        msg("Time out!");
        setTimeout(newRound, 1200);
      }
    }

    function msg(text) {
      msgEl.textContent = text;
      msgEl.classList.add('show');
      setTimeout(() => msgEl.classList.remove('show'), 1000);
    }

    function updateHUD() {
      document.getElementById('hud').innerHTML = 
        'Hearts'.repeat(lives) + 'Broken Heart'.repeat(3-lives) +
        ` | STREAK <strong>${streak}</strong> | Best: <strong>${best}</strong>`;
    }

    document.addEventListener('keydown', e => {
      if (!playing) return;
      if (/^[a-zA-Z]$/.test(e.key)) {
        typed += e.key.toLowerCase();
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Backspace') {
        typed = typed.slice(0,-1);
        typedEl.textContent = typed.toUpperCase();
      } else if (e.key === 'Enter') {
        submit();
      }
    });
  </script>
</body>
</html>
